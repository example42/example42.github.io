<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>The [DevOps] Puppet Guide - Slides for beginners</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>

  <link rel="stylesheet" href=".//css/reset.css" type="text/css"/>

  

  <link rel="stylesheet" type="text/css" href=".//css/fg.menu.css" media="screen" />
  <link rel="stylesheet" type="text/css" href=".//css/theme/ui.all.css" media="screen" />
  <link rel="stylesheet" type="text/css" href=".//css/highlight/atelier-cave.light.css"  />

  <link rel="stylesheet" type="text/css" href=".//css/showoff.css" />

  <!--[if lte IE 8]>
    <link rel="stylesheet" type="text/css" href=".//css/ie8.css" />
  <![endif]-->

  <script type="text/javascript" src=".//js/jquery-2.1.4.min.js"></script>

  <script type="text/javascript" src=".//js/jquery.cycle.all.js"></script>
  <script type="text/javascript" src=".//js/jquery-print.js"></script>
  <script type="text/javascript" src=".//js/jquery.batchImageLoad.js"></script>
  <script type="text/javascript" src=".//js/jquery.parsequery.min.js"></script>
  <script type="text/javascript" src=".//js/jquery.doubletap-0.1.js"></script>
  <script type="text/javascript" src=".//js/fg.menu.js"></script>
  <script type="text/javascript" src=".//js/jTypeWriter.js"> </script>
  <script type="text/javascript" src=".//js/highlight.pack.js"></script>

  <script type="text/javascript" src=".//js/coffee-script.js"></script>

  <script type="text/javascript" src=".//js/showoff.js"></script>

  
    
    <link rel="stylesheet" href=".//file/style.css" type="text/css"/>
  

  

  <script type="text/javascript">
    $(function(){
      setupPreso(false, './');
    });

    editUrl  = "";

    keymap = {
  "space": "NEXT",
  "d": "DEBUG",
  "up": "PREV",
  "left": "PREV",
  "pageup": "PREV",
  "down": "NEXT",
  "right": "NEXT",
  "pagedown": "NEXT",
  "r": "RELOAD",
  "c": "CONTENTS",
  "t": "CONTENTS",
  "h": "HELP",
  "/": "HELP",
  "?": "HELP",
  "b": "BLANK",
  ".": "BLANK",
  "F": "FOOTER",
  "f": "FOLLOW",
  "n": "NOTES",
  "esc": "CLEAR",
  "p": "PAUSE",
  "P": "PRESHOW",
  "x": "EXECUTE",
  "f5": "EXECUTE"
};
  </script>

</head>

<body>

<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="feedbackWrapper">
    <div id="feedbackSidebar">
        <img id="feedbackActivity" src=".//css/spinner.gif" />
        <h3>Live Interaction</h3>
        <div class="row">
          <h4>The presenter should...</h4>
          <span class="buttonWrapper slower"><button id="paceSlower">Slow Down</button></span>
          <span class="buttonWrapper faster"><button id="paceFaster">Speed Up</button></span>
        </div>
        <div class="row">
          <textarea id="question" placeholder="Ask a question..."></textarea>
          <button id="askQuestion">Ask a Question</button>
        </div>
        <hr />
        <h3>Material Feedback</h3>
        <div class="row">
          <h4>This slide is...</h4>
          Terrible
          <input type="radio" name="rating" value="1"></input>
          <input type="radio" name="rating" value="2"></input>
          <input type="radio" name="rating" value="3"></input>
          <input type="radio" name="rating" value="4"></input>
          <input type="radio" name="rating" value="5"></input>
          Awesome
          <textarea id="feedback" placeholder="Why...?"></textarea>
          <button id="sendFeedback">Send Feedback</button>
        </div>

        <div class="row tools">
          <button id="fileDownloads" onclick="window.open('/download');">File Downloads</button>
          
          <hr />
        </div>

        <div id="disclaimer">
          <p>Press <code>?</code> for help.</p>
          <p>All features are anonymous</p>
        </div>
    </div>
    <div id="feedbackHandle"></div>
</div>

<div id="help">
  <h1>Showoff Hotkeys</h1>
  <div>
    <span class="description">Move to the next slide.</span>
    <span class="action">NEXT</span>
    <span class="hotkeys"><span class="key">space</span><span class="key">down</span><span class="key">right</span><span class="key">pagedown</span></span>
  </div>
  <div>
    <span class="description">Move to the previous slide.</span>
    <span class="action">PREV</span>
    <span class="hotkeys"><span class="key">up</span><span class="key">left</span><span class="key">pageup</span></span>
  </div>
  <div>
    <span class="description">Show the table of contents menu.</span>
    <span class="action">CONTENTS</span>
    <span class="hotkeys"><span class="key">c</span><span class="key">t</span></span>
  </div>
  <div>
    <span class="description">Toggle follow mode.</span>
    <span class="action">FOLLOW</span>
    <span class="hotkeys"><span class="key">f</span></span>
  </div>
  <div>
    <span class="description">Show this help dialog.</span>
    <span class="action">HELP</span>
    <span class="hotkeys"><span class="key">h</span><span class="key">/</span><span class="key">?</span></span>
  </div>

  <hr />

  <div>
    <span class="description">Reload all slides.</span>
    <span class="action">RELOAD</span>
    <span class="hotkeys"><span class="key">r</span></span>
  </div>
  <div>
    <span class="description">Blank the screen.</span>
    <span class="action">BLANK</span>
    <span class="hotkeys"><span class="key">b</span><span class="key">.</span></span>
  </div>
  <div>
    <span class="description">Toggle the display footer.</span>
    <span class="action">FOOTER</span>
    <span class="hotkeys"><span class="key">F</span></span>
  </div>
  <div>
    <span class="description">Toggle notes display.</span>
    <span class="action">NOTES</span>
    <span class="hotkeys"><span class="key">n</span></span>
  </div>
  <div>
    <span class="description">Clear code execution results.</span>
    <span class="action">CLEAR</span>
    <span class="hotkeys"><span class="key">esc</span></span>
  </div>
  <div>
    <span class="description">Pause the presentation.</span>
    <span class="action">PAUSE</span>
    <span class="hotkeys"><span class="key">p</span></span>
  </div>
  <div>
    <span class="description">Display slideshow of <tt>preshow</tt> images on a timer.</span>
    <span class="action">PRESHOW</span>
    <span class="hotkeys"><span class="key">P</span></span>
  </div>
  <div>
    <span class="description">Execute the first visible code block.</span>
    <span class="action">EXECUTE</span>
    <span class="hotkeys"><span class="key">x</span><span class="key">f5</span></span>
  </div>

  <hr />

  <div>
    <span class="description">Show debugging information.</span>
    <span class="action">DEBUG</span>
    <span class="hotkeys"><span class="key">d</span></span>
  </div>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso"><center>loading presentation...</center></div>
<div id="footer">
  <span id="followMode"></span>
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
  <span id="slideFilename"></span>
  <img id="disconnected" src=".//css/disconnected.png" />
</div>

<div id="slides" class="offscreen" style="display:none;">
<div id="Cover_Cover" class="slide " data-transition="none">
<div class="content " ref="Cover/Cover">
<h1>Puppet Beginner</h1>

<p>A slides deck for audience with limited, fragmentary or no experience with Puppet.</p>

<p>It's about:</p>

<ul>
<li>Configuration management tools</li>
<li>Puppet and its ecosystem</li>
<li>Core concepts and terminology</li>
<li>Puppet Language basics</li>
<li>Learning References</li>
<li>Installation and basic usage</li>
</ul>

<p>This is part of:</p>

<h2>The [DevOps] Guide to Puppet, Universe, and Everything</h2>

<p>An <strong>Open Source</strong> holistic documentation project composed of:</p>

<ul>
<li>A <a href="https://github.com/example42/puppetguide-book" target="_blank">book</a>
</li>
<li>A set of sample <a href="https://github.com/example42/puppetguide-architectures" target="_blank">code architectures</a>
</li>
<li>A <a href="https://github.com/example42/puppetguide-slides" target="_blank">slides deck</a> (this one)</li>
<li>The <a href="https://github.com/example42/puppetguide-reference" target="_blank">Puppet Universal Reference</a>
</li>
</ul>

<h4>Started by <a href="http://www.example42.com" target="_blank">example42</a>
</h4>

<h6>NOTE: All these contents are and will always be WIPAI (Work In Progress, Always Improving).</h6>
</div>
</div>
<div id="Cover_First_Page" class="slide " data-transition="none">
<div class="content " ref="Cover/First_Page">
<h1>Puppet Beginner</h1>

<h2>Sections</h2>

<h3>Introduction to Puppet</h3>

<p>An introduction to Configuration Management tools, their principles and role in a [DevOps] tool chain.</p>

<p>An overview of Puppet and its ecosystem, composed of different tools and endless integrations.</p>

<p>A guided reference of Puppet learning resources, online references and core concepts.</p>

<h3>Language Basics</h3>

<p>General overview of Puppet DSL with examples of common resources.</p>

<p>Modules principles and usage patterns.</p>

<h3>Using Puppet</h3>

<p>A basic outline of Puppet installation and usage modes.</p>

<p>A review of what happens during a Puppet run.</p>

<h3>Appendix</h3>

<p>A brief history of Puppet versions.</p>

<p>Some hints on Puppet 4 migration.</p>

<p>An overview of Hiera</p>
</div>
</div>
<div id="Introduction_Overview" class="slide " data-transition="none">
<div class="content " ref="Introduction/Overview">
<h1>Introduction</h1>

<h2>Contents</h2>

<ul>
<li>What is Puppet?</li>
<li>Configuration management</li>
<li>Learning References</li>
<li>Puppet ecosystem</li>
<li>Essential Puppet concepts</li>
</ul>

<h2>Take-aways</h2>

<ul>
<li>Know what is Puppet</li>
<li>Understand the principles behind configuration management tools</li>
<li>Know where to find information about Puppet</li>
<li>Have a general view of Puppet software ecosystem</li>
<li>Understand the logic and core principles of Puppet</li>
</ul>
</div>
</div>
<div id="Introduction_What_is_Puppet" class="slide " data-transition="none">
<div class="content " ref="Introduction/What_is_Puppet">
<h1>What is Puppet?</h1>

<p>Puppet is an Open Source <strong>Configuration Management</strong> software developed by <a href="http://www.puppetlabs.com" target="_blank">Puppet Labs</a></p>

<p>More widely Puppet is a framework for <strong>Systems Automation</strong> since it automates the configuration and ongoing management of our servers, in a centrally managed way.</p>

<p>It allows to define, with a <strong>declarative</strong> Domain Specific Language (<strong>DSL</strong>), what we want to configure and manage on an Operating System (OS): packages to install, services to start, files to configure and any system resource we can map and express in Puppet language.</p>

<p>Puppet works on Linux, Unix (Solaris, AIX, *BSD), MacOS, Windows (<a href="http://docs.puppetlabs.com/guides/platforms.html" target="_blank">List of Supported Platforms</a>) and can be used also to configure network and storage devices or manage cloud resources.</p>

<p>It is used by <a href="http://puppetlabs.com/customers/companies/" target="_blank">many companies</a> with a number of managed systems than ranges from few dozens to several thousands.</p>

<p>Puppet Labs releases also <a href="https://puppetlabs.com/puppet/puppet-enterprise" target="_blank">Puppet Enterprise</a> (<strong>PE</strong>) based on the <a href="https://github.com/puppetlabs/puppet" target="_blank">Open Source code base</a> and oriented to enterprises that need official support and want Puppet infrastructure easier to setup and with better reporting and management features.</p>
</div>
</div>
<div id="Introduction_Configuration_Management" class="slide " data-transition="none">
<div class="content " ref="Introduction/Configuration_Management/1">
<h1>DevOps and Configuration management</h1>

<p>DevOps is a <a href="https://en.wikipedia.org/wiki/DevOps" target="_blank">term</a> that involves a remarkable number of concepts, nuances and definitions.</p>

<p>We won't try to give another one, but we can safely say that DevOps is (also) about <strong>culture</strong>, <strong>processes</strong>, <strong>people</strong> and <strong>tools</strong>.</p>

<p>A complete <a href="https://xebialabs.com/the-ultimate-devops-tool-chest/" target="_blank">DevOps tools chain</a> contains software of these categories:</p>

<ul>
<li>Source Code Management (&lt;- We use them when writing Puppet code)</li>
<li>Repository and software Management  (&lt;- Puppet can configure them)</li>
<li>Software build (&lt;- Puppet can configure them)</li>
<li>Configuration Management (<strong>&lt;- Puppet is here</strong>)</li>
<li>Testing  (&lt;- We can test our Puppet code)</li>
<li>Monitoring and data analysis  (&lt;- Puppet can configure them)</li>
<li>Systems and Applications Deployment (&lt;- Puppet can be also here)</li>
<li>Continuous integration  (&lt;- We can manage Puppet code deployments in a CI pipeline)</li>
<li>Cloud (&lt;- Puppet code can manage cloud resources)</li>
<li>Project management and Issue tracking  (&lt;- We can use them to manage our Puppet projects)</li>
<li>Messaging and Collaboration (&lt;- We can use them to collaborate on Puppet works)</li>
<li>Containerization and Virtualization (&lt;- Puppet can configure them)</li>
<li>Databases (&lt;- Puppet can configure them)</li>
<li>Application servers (&lt;- Puppet can configure them)</li>
</ul>
</div>
</div>
<div id="Introduction_Configuration_Management" class="slide " data-transition="none">
<div class="content " ref="Introduction/Configuration_Management/2">
<h1>Configuration Management principles</h1>

<p>Configuration management tools allow to programmatically define how servers have to be configured. Their main benefits are:</p>

<ul>
<li>
<strong>Automation</strong>: No need to manually configure systems</li>
<li>
<strong>Reproducibility</strong>: Setup once, repeat forever</li>
<li>
<strong>Scale</strong>: Done for one, use on many</li>
<li>
<strong>Coherent</strong> and consistent server setups</li>
<li>
<strong>Aligned Environments</strong> for devel, test, qa, prod nodes</li>
</ul>

<p>Configuration management tools typically describe the systems setups via code or data (<strong>Infrastructure as Code</strong>), this involves a paradigm change in system administration:</p>

<ul>
<li>Systems are managed <strong>centrally</strong> in an <strong>automated</strong> way: no more manually</li>
<li>Code is versioned with a Source Control Management tool (<strong>git</strong> is the most used in Puppet world)</li>
<li>Commits history shows the <strong>history of change</strong> on the infrastructure (who, what, when and why)</li>
<li>Code can be <strong>tested</strong> before deployment in production</li>
<li>Code has to be <strong>deployed</strong>
</li>
</ul>
</div>
</div>
<div id="Introduction_Configuration_Management" class="slide " data-transition="none">
<div class="content " ref="Introduction/Configuration_Management/3">
<h1>Configuration Management tools</h1>

<p>Common alternatives to Puppet:</p>

<h4><a href="https://www.chef.io/" target="_blank">Chef</a></h4>

<ul>
<li>Has Chef clients that connect to Chef server</li>
<li>Has characteristic similar to Puppet</li>
<li>Community code is shared on the <a href="https://galaxy.ansible.com/intro#review" target="_blank">Chef Supermarket</a>
</li>
<li>Chef code is Ruby with dedicated extensions</li>
<li>Software developed in Ruby.</li>
</ul>

<h4><a href="http://cfengine.com/" target="_blank">CFEngine</a></h4>

<ul>
<li>The first and oldest of the bunch</li>
<li>CFEngine3 is a complete and modern rework</li>
<li>Different daemons for different functions in a distributed environment</li>
<li>Based on the <a href="https://en.wikipedia.org/wiki/Promise_theory" target="_blank">Promise theory</a>
</li>
<li>Cfengine code is a test based list of pro</li>
<li>Software developed in C by Prof. Mark Burgess.</li>
</ul>

<h4><a href="http://saltstack.com/" target="_blank">Salt</a></h4>

<ul>
<li>Manages deployments on multiple clouds in a fast way</li>
<li>Salt code is composed of states (Puppet resources) written in YAML files</li>
<li>
<a href="https://github.com/saltstack-formulas" target="_blank">Formulas</a> are equivalent to modules</li>
<li>Sotfware developed in Python</li>
</ul>

<h4><a href="http://www.ansibleworks.com/" target="_blank">Ansible</a></h4>

<ul>
<li>Quick setup, no agents, communications over SSH</li>
<li>Ansible code is YAML based and written on playbooks</li>
<li>Roles are equivalent to modules, they are shared on the <a href="https://galaxy.ansible.com/intro#review" target="_blank">Ansible Galaxy</a>
</li>
<li>Can centralise multi node task executions, software deployments and configuration management.</li>
<li>Software eveloped in Python. Bought by RedHat in October 2015</li>
</ul>
</div>
</div>
<div id="Introduction_Learning_resources" class="slide " data-transition="none">
<div class="content " ref="Introduction/Learning_resources">
<h1>Learning resources</h1>

<p>Useful resources to start learning Puppet:</p>

<ul>
<li>The website of <a href="http://puppetlabs.com" target="_blank">Puppet Labs</a>, the company behind Puppet</li>
<li>The official <a href="http://docs.puppetlabs.com/" target="_blank">Puppet Documentation site</a> -</li>
<li>
<a href="" target="_blank">The Learning VM</a>, based on Puppet Enterprise, for a guided tour in Puppet world</li>
<li>A list of the available <a href="https://puppetlabs.com/resources/books" target="_blank">Puppet Books</a>
</li>
</ul>

<p>If you have questions to ask about Puppet usage use these:</p>

<ul>
<li>All the <a href="http://puppetlabs.com/community/overview/" target="_blank">Puppet Community</a> references</li>
<li>
<a href="http://ask.puppetlabs.com/" target="_blank">Ask Puppet</a>, the official Q&amp;A site</li>
<li>The discussion groups on Google Groups: <a href="https://groups.google.com/forum/#!forum/puppet-users" target="_blank">puppet-users</a>, <a href="https://groups.google.com/forum/#!forum/puppet-dev" target="_blank">puppet-dev</a>, <a href="https://groups.google.com/forum/#!forum/puppet-security-announce" target="_blank">puppet-security-announce</a>
</li>
</ul>

<p>To explore and use existing Puppet code:</p>

<ul>
<li>Puppet modules on <a href="http://forge.puppetlabs.com" target="_blank">Module Forge</a>
</li>
<li>Puppet modules on <a href="https://github.com/search?q=puppet" target="_blank">GitHub</a>
</li>
</ul>

<p>To inform yourself about what happens in Puppet World</p>

<ul>
<li>
<a href="http://www.planetpuppet.org/" target="_blank">Planet Puppet</a> - Puppet blogosphere</li>
<li>The <a href="http://www.puppetconf.com" target="_blank">PuppetConf</a> website</li>
<li>The ongoing <a href="" target="_blank">PuppetCamps</a> all over the world</li>
</ul>

<p>To find more and deeper information:</p>

<ul>
<li>
<a href="https://tickets.puppetlabs.com" target="_blank">Puppet Labs tickets</a> - The official ticketing system</li>
<li>
<a href="http://docs.puppetlabs.com/references/latest/developer/" target="_blank">Developer reference</a> - The commented Puppet code</li>
<li>
<a href="http://bitergia.dev.puppetlabs.com/browser/" target="_blank">Puppet Stats</a> - Puppet relate metrics and stats</li>
</ul>
</div>
</div>
<div id="Introduction_Essential_concepts" class="slide " data-transition="none">
<div class="content " ref="Introduction/Essential_concepts">
<h1>Essential Puppet concepts</h1>

<p>When approaching Puppet it's important to understand it's basic concepts and terminology.</p>

<p>A complete official <a href="http://docs.puppetlabs.com/references/glossary.html" target="_blank">glossary</a> is online, use it.</p>

<p>Here we outline a few essential Puppet concepts, be sure to understand them all:</p>

<ul>
<li>A typical Puppet setup is based on a client-server architecture: the client is also called <strong>agent</strong> (or <strong>agent node</strong> or simply <strong>node</strong>), the server is called <strong>master</strong>
</li>
<li>When the puppet client connects to the server, it sends it's own ssl <strong>certname</strong> and a list of <strong>facts</strong> (units of information about the client's system generated by the command <strong>facter</strong>)</li>
<li>Based on the client <strong>certname</strong> and its facts, the master replies with a <strong>catalog</strong> that describes what has to be configured on the client</li>
<li>The catalog is based on Puppet code, which is written in <strong>manifests</strong> (files with <strong>.pp</strong> extension)</li>
<li>In the Puppet code we declare <strong>resources</strong> that affect elements of the system (files, packages, services ...)</li>
<li>Resources are grouped in <strong>classes</strong> which may expose <strong>parameters</strong> that affect their behavior.</li>
<li>The values of the class parameters can be defined in different ways, one of them is <strong>Hiera</strong>
</li>
<li><p><strong>Hiera</strong> is a very common and versatile tool to store the values of parameters</p></li>
<li><p>Classes and the configuration files that are shipped to nodes are organized in <strong>modules</strong>.</p></li>
</ul>
</div>
</div>
<div id="Introduction_Puppet_ecosystem" class="slide " data-transition="none">
<div class="content " ref="Introduction/Puppet_ecosystem/1">
<h1>Puppet ecosystem</h1>

<h2>Puppet Labs software products</h2>

<p>Puppet ecosystem is composed of many software projects.
The ones developed by PuppetLabs are:</p>

<ul>
<li>
<a href="http://docs.puppetlabs.com/puppet/" target="_blank">Puppet</a> - Official Puppet Open Source documentation</li>
<li><p><a href="http://docs.puppetlabs.com/pe/" target="_blank">Puppet Enterprise</a> - The commercial enterprise version of Puppet</p></li>
<li><p><a href="http://docs.puppetlabs.com/facter/" target="_blank">Facter</a> - Complementary tool to retrieve system's data</p></li>
<li><p><a href="http://docs.puppetlabs.com/puppetserver/" target="_blank">Puppet Server</a> - The next generation server service</p></li>
<li><p><a href="http://docs.puppetlabs.com/hiera/" target="_blank">Hiera</a> - Key-value lookup tool where Puppet data can be placed</p></li>
<li><p><a href="http://docs.puppetlabs.com/puppetdb/" target="_blank">PuppetDB</a> - Stores all the data generated by Puppet</p></li>
<li><p><a href="http://docs.puppetlabs.com/mcollective/" target="_blank">MCollective</a> - Infrastructure Orchestration framework</p></li>
<li><p><a href="http://docs.puppetlabs.com/pe/latest/razor_intro.html/" target="_blank">Razor</a> - A provisioning system</p></li>
<li><p><a href="http://puppetlabs.github.io/geppetto/" target="_blank">Geppetto</a> - A Puppet IDE based on Eclipse</p></li>
<li><p><a href="https://github.com/puppetlabs/r10k/" target="_blank">r10k</a> - A tool to manage deployments of Puppet code</p></li>
</ul>
</div>
</div>
<div id="Introduction_Puppet_ecosystem" class="slide " data-transition="none">
<div class="content " ref="Introduction/Puppet_ecosystem/2">
<h1>Puppet ecosystem</h1>

<h2>Community resources</h2>

<p>Soe of the most known Puppet related community projects are:</p>

<ul>
<li>
<a href="https://puppet.community/" target="_blank">Puppet Community</a> - Modules and tooling for and by the Puppet Community</li>
<li>
<a href="http://www.puppetcookbook.com/" target="_blank">Puppet CookBook</a> - A collection of task oriented solutions in Puppet</li>
<li>
<a href="https://github.com/sodabrew/puppet-dashboard/" target="_blank">Puppet DashBoard</a> - A Puppet <em>Web frontend</em> and External Node Classifier (ENC)</li>
<li>
<a href="http://theforeman.org/" target="_blank">The Foreman</a> - A well-known third party provisioning tool and Puppet ENC</li>
<li>
<a href="https://github.com/puppet-community/puppetboard" target="_blank">PuppetBoard</a> - A web frontend for PuppetDB</li>
<li>
<a href="http://puppet-lint.com/" target="_blank">Puppet Lint</a> - A tool to check Puppet code style</li>
<li>
<a href="http://rspec-puppet.com/" target="_blank">Rspec Puppet</a> - A tool to make unit tests of Puppet code</li>
<li>
<a href="http://www.kermit.fr/" target="_blank">Kermit</a> - A web frontend for MCollective</li>
</ul>
</div>
</div>
<div id="Language_basics_Overview" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Overview">
<h1>Language Basics</h1>

<h2>Contents</h2>

<ul>
<li>Nodes classification</li>
<li>The Catalog</li>
<li>Variables and parameters</li>
<li>Resource types</li>
<li>Classes and defines</li>
<li>Modules</li>
</ul>

<h2>Take-aways</h2>

<ul>
<li>Understand how Puppet delivers the right configurations to each node</li>
<li>Know what is the Catalog</li>
<li>Understand usage of variables and facts</li>
<li>Know how is declared a Puppet resource</li>
<li>Understand the RAL (Resource ABstraction Layer) principles</li>
<li>Know how are Puppet classes and defines</li>
<li>Understand modules structure, usage and paths conventions</li>
<li>Know how to write erb templates</li>
</ul>
</div>
</div>
<div id="Language_basics_Nodes_classification" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Nodes_classification">
<h1>Nodes classification</h1>

<p>When clients connect, the Puppet Master generates a <strong>catalog</strong> with the list of the resources that clients have to apply locally.</p>

<p>The Puppet Master has to <em>classify</em> nodes and define for each of them:</p>

<ul>
<li>The <strong>classes</strong> to include</li>
<li>The <strong>parameters</strong> to pass</li>
<li>The Puppet <strong>environment</strong> to use</li>
</ul>

<p>Nodes classification can be done in different ways (more details will follow):</p>

<ul>
<li>Using the <code>node</code> definition in Puppet code</li>
<li>Using and <strong>External Node Classifier</strong> (ENC): a separated tool that provides classification info</li>
<li>Using the <code>hiera_include</code> function</li>
<li>Using a nodeless setup: the classes to include are defined according to variables and facts.</li>
</ul>
</div>
</div>
<div id="Language_basics_Catalog" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Catalog">
<h1>The Catalog</h1>

<p>The <strong>catalog</strong> is the complete list of resources, and their relationships, that the Puppet Master generates for the client and sends it in Json format.</p>

<p>It's the result of all the puppet code and logic that we define for a given node in our manifests and is applied on the client after it has been received from the master.</p>

<p>The client uses the RAL (Resource Abstraction Layer) to execute the actual system's commands that convert abstract resources like</p>

<pre><code>package { 'openssh': }
</code></pre>

<p>to their actual fulfillment on the system, such as</p>

<pre><code>apt-get install openssh # On Debian derivatives
yum install openssh     # On RedHat derivatives
</code></pre>

<p>The catalog is saved by the client in:</p>

<pre><code>$libdir/client_data/catalog/$certname.json
</code></pre>
</div>
</div>
<div id="Language_basics_Resources" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Resources/1">
<h1>Resource Types (Types)</h1>

<p>Resource Types are single <strong>units of configuration</strong> composed by:</p>

<ul>
<li>A <strong>type</strong> (package, service, file, user, mount, exec ...)</li>
<li>A <strong>title</strong> (how is called and referred)</li>
<li>Zero or more <strong>arguments</strong>
</li>
</ul>

<p>The syntax is as follows:</p>

<pre><code>type { 'title':
  argument  =&gt; value,
  other_arg =&gt; value,
}
</code></pre>

<p>Example for a <strong>file</strong> resource type:</p>

<pre><code>file { 'motd':
  path    =&gt; '/etc/motd',
  content =&gt; 'Tomorrow is another day',
}
</code></pre>
</div>
</div>
<div id="Language_basics_Resources" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Resources/2">
<h1>Resource Types reference</h1>

<p>Find online the complete <a href="http://docs.puppetlabs.com/references/latest/type.html" target="_blank">Type Reference</a> for the latest or earlier versions.</p>

<p>From the shell the command line interface:</p>

<pre><code>puppet describe file
</code></pre>

<p>For the full list of available descriptions try:</p>

<pre><code>puppet describe --list
</code></pre>

<p>Give a glance to Puppet code for the list of <strong>native</strong> resource types:</p>

<pre><code>ls $(facter rubysitedir)/puppet/type
</code></pre>

<p>The most common native resources, shipped with Puppet by default are: package, service, file, user, group, cron, exec, mount...</p>
</div>
</div>
<div id="Language_basics_Resources" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Resources/3">
<h1>Simple samples of resources</h1>

<p>Installation of OpenSSH package:</p>

<pre><code>package { 'openssh':
  ensure =&gt; present,
}
</code></pre>

<p>Creation of /etc/motd file:</p>

<pre><code>file { 'motd':
  path =&gt; '/etc/motd',
}
</code></pre>

<p>Start of httpd service:</p>

<pre><code>service { 'httpd':
  ensure =&gt; running,
  enable =&gt; true,
}
</code></pre>

<p>Creation of oscar user:</p>

<pre><code>user { 'oscar':
  ensure =&gt; present,
  uid    =&gt; 1024,
}
</code></pre>

<p>Each of these resources have several other arguments that allows to define every characteristic of the resource.</p>
</div>
</div>
<div id="Language_basics_Resources" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Resources/4">
<h1>More complex examples</h1>

<p>Here are some more complex examples with usage of variables, resource references, arrays and relationships.</p>

<p>Management of nginx service with parameters defined in module's variables</p>

<pre><code>service { 'nginx':
  ensure     =&gt; $::nginx::manage_service_ensure,
  name       =&gt; $::nginx::service_name,
  enable     =&gt; $::nginx::manage_service_enable,
}
</code></pre>

<p>Creation of nginx.conf with content retrieved from different sources (first found is served)</p>

<pre><code>file { 'nginx.conf':
  ensure  =&gt; present,
  path    =&gt; '/etc/nginx/nginx.conf',
  source  =&gt; [
      "puppet:///modules/site/nginx.conf--${::fqdn}",
      "puppet:///modules/site/nginx.conf"
  ],
}
</code></pre>

<p>Installation of the Apache package triggering a restart of the relevant service:</p>

<pre><code>package { 'httpd':
  ensure =&gt; $ensure,
  name   =&gt; $apache_package,
  notify =&gt; Class['Apache::Service'],
}
</code></pre>
</div>
</div>
<div id="Language_basics_Resources" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Resources/5">
<h1>Resource Abstraction Layer</h1>

<p>Resources are abstracted from the underlying OS, this is achieved via the <strong>Resource Abstraction Layer</strong> (RAL) composed of resource <strong>types</strong> that can have different <strong>providers</strong>.</p>

<p>A type specifies the attributes that a given resource may have, a provider implements the relevant type on the underlying Operating System.</p>

<p>For example the <code>package</code> type is known for the great number of providers (yum, apt, msi, gem ... ).</p>

<pre><code>ls $(facter rubysitedir)/puppet/provider/package
</code></pre>

<p>With the command <code>puppet resource</code> we can represent the current status of a system's resources in Puppet language (note this can be done for any resource, even the ones not managed by Puppet):</p>

<p>To show all the exisiting users on a system (or only the root user):</p>

<pre><code>puppet resource user
puppet resource user root
</code></pre>

<p>To show all the installed packages:</p>

<pre><code>puppet resource package
</code></pre>

<p>To show all the system's services:</p>

<pre><code>puppet resource service
</code></pre>

<p>It's also possible to directly modify them with <code>puppet resource</code> (note that this is not generally the way Puppet is used to manage the system's resources):</p>

<pre><code>puppet resource service httpd ensure=running enable=true
</code></pre>
</div>
</div>
<div id="Language_basics_Variables" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Variables/1">
<h1>Variables</h1>

<p>Variables is Puppet codes are basically <strong>constants</strong>: once defined in a class we can't change them.</p>

<p>We can set variables in our Puppet code with this syntax:</p>

<pre><code># Normal variable assignment
$role = 'mail'

# The value of a variable is based on another variable (here used the **selector** costruct)
$package = $::operatingsystem ? {
  /(?i:Ubuntu|Debian|Mint)/ =&gt; 'apache2',
  default                   =&gt; 'httpd',
}
</code></pre>

<p>Puppet automatically provides also some <strong>internal</strong> variables, the most common are:</p>

<pre><code># The name of the node (the certname setting in its puppet.conf)
$clientcert # Default is the client's Fully Qualified Domain Name)

# The Puppet's environment where the Master looks for the code to compile
$environment # Default is "production"

# The Master's FQDN and IP address
$servername $serverip

# Any configuration setting of the Puppet Master's puppet.conf
$settings::&lt;setting_name&gt;:

# The name of the module that contains the current resource's definition
$module_name
</code></pre>
</div>
</div>
<div id="Language_basics_Variables" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Variables/2">
<h1>Facter and facts</h1>

<p><strong>Facter</strong> is a tools shipped with Puppet. It runs on clients and collects <strong>facts</strong> which are sent to the server. In our code we can use facts to manage resources in different ways or with different arguments.</p>

<p>Here follows a list of the most common and useful facts:</p>

<pre><code>al$ facter

architecture =&gt; x86_64
fqdn =&gt; Macante.example42.com
hostname =&gt; Macante
ipaddress_eth0 =&gt; 10.42.42.98
macaddress_eth0 =&gt; 20:c9:d0:44:61:57
operatingsystem =&gt; Centos
operatingsystemrelease =&gt; 6.3
osfamily =&gt; RedHat
virtual =&gt; physical
</code></pre>

<p>It's easy to create custom facts. They can be of 2 types:</p>

<ul>
<li>
<strong>Native facts</strong> written in ruby and shipped with modules (in the <code>lib/facter</code> directory)</li>
<li>
<strong>External facts</strong> can be simple ini-file like texts (with <code>.txt</code> extension), Yaml files or even commands in any language, which returns a fact name and its value. External facts are located in the nodes' <code>/etc/facter/facts.d</code> directory and can be shipped also from modules (in the <code>facts.d</code> directory)</li>
</ul>
</div>
</div>
<div id="Language_basics_Classes" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Classes/1">
<h1>Classes</h1>

<p>Classes are <strong>containers</strong> of different resources. Since Puppet 2.6 they can have parameters.</p>

<p>Example of a class <strong>definition</strong> (here we describe what the class does and what parameters it has, we don't actually add it and its resources to the catalog):</p>

<pre><code>class mysql (
  root_password = 'default_value',
  port          = '3306',
) {
  package { 'mysql-server': ensure =&gt; present }
  service { 'mysql': ensure =&gt; running }
  [...]
}
</code></pre>

<p>When we have to use a class previously defined, we <strong>declare</strong> it. Class declaration can be done in 2 different ways:</p>

<p>"Old style" class declaration, without parameters (inside a catalog we can have multiple <code>include</code> of the same class but that class it's applied only once):</p>

<pre><code>include mysql
</code></pre>

<p>"New style" (from Puppet 2.6) class declaration with explicit parameters (Syntax is the same of normal resources and the same class can be declared, in this way, only once inside the same catalog):</p>

<pre><code>class { 'mysql':
  root_password =&gt; 'my_value',
  port          =&gt; '3307',
}
</code></pre>
</div>
</div>
<div id="Language_basics_Classes" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Classes/2">
<h1>Defines</h1>

<p>Also called: <strong>Defined resource types</strong> or <strong>defined types</strong></p>

<p>Similar to parametrized classes but can be used multiple times (with different titles).</p>

<p><strong>Definition</strong> of a define:</p>

<pre><code>define apache::virtualhost (
  $ensure   = present,
  $template = 'apache/virtualhost.conf.erb' ,
  [...] ) {

  file { "ApacheVirtualHost_${name}":
    ensure  =&gt; $ensure,
    content =&gt; template("${template}"),
  }
}
</code></pre>

<p><strong>Declaration</strong> of a define:</p>

<pre><code>apache::virtualhost { 'www.example42.com':
  template =&gt; 'site/apache/www.example42.com-erb'
}
</code></pre>
</div>
</div>
<div id="Language_basics_Modules" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Modules/1">
<h1>Modules</h1>

<p>Self Contained and Distributable <em>recipes</em> contained in a directory with a predefined structure</p>

<p>Used to manage an application, system's resources, a local site or more complex structures</p>

<p>Modules must be placed in the Puppet Master's modulepath</p>

<pre><code>puppet config print modulepath
/etc/puppet/modules:/usr/share/puppet/modules
</code></pre>

<p>Puppet module tool to interface with Puppet Modules Forge</p>

<pre><code>puppet help module
[...]
ACTIONS:
  build        Build a module release package.
  changes      Show modified files of an installed module.
  generate     Generate boilerplate for a new module.
  install      Install a module from the Puppet Forge or an archive.
  list         List installed modules
  search       Search the Puppet Forge for a module.
  uninstall    Uninstall a puppet module.
  upgrade      Upgrade a puppet module.
</code></pre>

<p>GitHub, also, is full of Puppet modules</p>
</div>
</div>
<div id="Language_basics_Modules" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Modules/2">
<h1>Paths of a module</h1>

<p>Modules have a standard structure:</p>

<pre><code>mysql/            # Main module directory

mysql/manifests/  # Manifests directory. Puppet code here.
mysql/lib/        # Plugins directory. Ruby code that extends Puppet here.
mysql/templates/  # ERB and EPP Templates directory
mysql/files/      # Static files directory
mysql/spec/       # Puppet-rspec directory
mysql/tests/      # Tests / Usage examples directory

mysql/Modulefile  # Module's metadata descriptor
</code></pre>

<p>This layout enables useful conventions</p>
</div>
</div>
<div id="Language_basics_Modules" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Modules/3">
<h1>Modules paths conventions</h1>

<p>Classes and defines autoloading:</p>

<pre><code>include mysql
# Main mysql class is placed in: $modulepath/mysql/manifests/init.pp

include mysql::server
# This class is defined in: $modulepath/mysql/manifests/server.pp

mysql::conf { ...}
# This define is defined in: $modulepath/mysql/manifests/conf.pp

include mysql::server::ha
# This class is defined in: $modulepath/mysql/manifests/server/ha.pp
</code></pre>

<p>Provide files based on Erb Templates (Dynamic content)</p>

<pre><code>content =&gt; template('mysql/my.cnf.erb'),
# Template is in: $modulepath/mysql/templates/my.cnf.erb
</code></pre>

<p>Provide static files (Static content). Note we can't use content AND source for the same file.</p>

<pre><code>source =&gt; 'puppet:///modules/mysql/my.cnf'
# File is in: $modulepath/mysql/files/my.cnf
</code></pre>
</div>
</div>
<div id="Language_basics_Modules" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Modules/4">
<h1>ERB templates</h1>

<p>Files with .erb extension used typicall by in <code>file</code> resources.</p>

<p>Inside these files ruby code can be interpolated inside the  <code>&lt;%</code> and <code>%&gt;</code> tags.</p>

<p>Example of an erb template:</p>

<pre><code># Show facts values
hostname = &lt;%= @::fqdn %&gt;

# Show values of variables outside local scope, two methods:
ntp_server = &lt;%= scope.lookupvar('::ntp::server') %&gt;
ntp_server = &lt;%= scope['::ntp::server'] %&gt;

# Iteration over an array
&lt;% @::dns_servers.each do |ns| %&gt;
nameserver &lt;%= ns %&gt;
&lt;% end %&gt;

# Conditional blocks of texts
&lt;% if scope.lookupvar('puppet::db') == "puppetdb" -%&gt;
storeconfigs_backend = puppetdb
&lt;% end -%&gt;
</code></pre>

<p>Note the ending <code>-%&gt;</code>: when dash is present, no new line is introduced on the generated file.</p>
</div>
</div>
<div id="Language_basics_Practice" class="slide " data-transition="none">
<div class="content " ref="Language_basics/Practice">
<h1>Practice: Language Basics</h1>

<p>On a test machine <strong>install Puppet</strong> if not already installed.</p>

<p>Practice with the <strong>commands</strong>:</p>

<pre><code>puppet describe
puppet resource
facter
</code></pre>

<p>Create a <strong>manifest</strong> file and in that file manage the installation of the package and the management of the service of <em>nginx</em>.</p>

<p>Use <code>puppet apply</code> to apply the resources declared in our manifest.</p>
</div>
</div>
<div id="Using_Puppet_Overview" class="slide " data-transition="none">
<div class="content " ref="Using_Puppet/Overview">
<h1>Using Puppet</h1>

<h2>Contents</h2>

<ul>
<li>Installation of different Puppet versions</li>
<li>Configuration files and parameters</li>
<li>Puppet cli commands</li>
<li>Files paths</li>
<li>Troubleshooting</li>
</ul>

<h2>Take-aways</h2>

<ul>
<li>Know how to install different versionf of Puppet</li>
<li>Know where to find the most important files</li>
<li>Understand the basics of Puppet configuration</li>
<li>Understand Puppet run modes (agent/apply)</li>
<li>Use puppet command</li>
<li>Have to basics to troublshoot Puppet</li>
</ul>
</div>
</div>
<div id="Using_Puppet_Installation" class="slide " data-transition="none">
<div class="content " ref="Using_Puppet/Installation/1">
<h1>Open Source Puppet Puppet installation</h1>

<p>Puppet can be found by default in most distributions.</p>

<p>It generally recommended to use <a href="http://docs.puppetlabs.com/guides/puppetlabs_package_repositories.html" target="_blank">Puppet Labs repositories</a> for the latest updates.</p>

<p>Check the <a href="http://docs.puppetlabs.com/guides/installation.html" target="_blank">Installation Instructions</a> for different OS.</p>

<h2>Puppet 3.x installation</h2>

<p>On Debian and derivates, you can install it with:</p>

<pre><code>apt-get install puppet       # On clients (nodes)
apt-get install puppetmaster # On server (master)
</code></pre>

<p>On RedHat and derivates you need to add the EPEL repository or RHN Extra channel:</p>

<pre><code>yum install puppet        # On clients (nodes)
yum install puppet-server # On server (master)
</code></pre>

<h2>Puppet 4 installation</h2>

<p>Puppet version 4 can be installed using <a href="https://puppetlabs.com/blog/welcome-puppet-collections" target="_blank">Puppet Labs Software Collections</a>, once added the relevant repositories for your distro you can install it with:</p>

<pre><code>[apt-get|yum] install puppet-agent   # On clients (nodes)
[apt-get|yum] install puppet-server  # On server (master)
</code></pre>
</div>
</div>
<div id="Using_Puppet_Installation" class="slide " data-transition="none">
<div class="content " ref="Using_Puppet/Installation/2">
<h1>Puppet Enterprise installation</h1>

<p>For complete installation instruction check the <a href="https://docs.puppetlabs.com/pe/latest/install_basic.html" target="_blank">Official Documentation</a></p>

<p>Puppet Enterprise is licenced software, you can request an trial version from <a href="https://puppetlabs.com/download-puppet-enterprise" target="_blank">the Download page</a>, it's free up to 10 managed nodes</p>

<h2>Puppet Enterprise Server setup</h2>

<ul>
<li><p>Get the tar from <a href="https://puppetlabs.com/download-puppet-enterprise" target="_blank">the Download page</a></p></li>
<li>
<p>Unpack and run:</p>

<p>tar -xf <tarball>
cd <tarballdir>
sudo ./puppet-enterprise-installer</tarballdir></tarball></p>
</li>
<li><p>Via browser open <code>https://&lt;server_name&gt;:3000</code> and follow up with web based installation (don't close your installer terminal window)</p></li>
<li><p>Choose between <strong>all in one</strong> installation or split installation, set the puppet server certname and aliases, set the console admin password and other installation options</p></li>
<li><p>Once installed, open the <strong>Puppet Enterprise Console</strong> via browser at <code>https://server_name&gt;</code>, with user <strong>admin</strong> and the password set before</p></li>
</ul>

<h2>Puppet Enterprise agent setup</h2>

<p>Check the official <a href="http://docs.puppetlabs.com/pe/latest/install_agents.html" target="_blank">install client documentation</a> for complete reference.</p>

<p>Different alternatives:</p>

<ul>
<li>
<p>Run the remote installation script:</p>

<pre><code>curl -k https://&lt;puppet_server&gt;:8140/packages/current/install.bash | sudo bash
</code></pre>
</li>
<li>
<p>Distribute the tarball and eventually use an answer file for unattended setup:</p>

<pre><code>sudo ./puppet-enterprise-installer -a ~/pe_answers.txt
</code></pre>
</li>
<li><p>Use dedicated public modules</p></li>
</ul>
</div>
</div>
<div id="Using_Puppet_Configuration" class="slide " data-transition="none">
<div class="content " ref="Using_Puppet/Configuration/1">
<h1>Puppet configuration: puppet.conf</h1>

<p>It's Puppet main configuration file.</p>

<p>On open source Puppet 3 is generally in:</p>

<pre><code>/etc/puppet/puppet.conf
</code></pre>

<p>On Puppet Enterprise and Puppet 4 is in:</p>

<pre><code>/etc/puppetlabs/puppet/puppet.conf
</code></pre>

<p>On Windows is in:</p>

<pre><code>C:\ProgramData\PuppetLabs\puppet\etc
</code></pre>

<p>When running as a normal user can be placed in the home directory:</p>

<pre><code>/home/&lt;user&gt;/.puppet/puppet.conf
</code></pre>

<p>Configurations are divided in [stanzas] for different Puppet sub commands</p>

<p>Common for all commands: <strong>[main]</strong></p>

<p>For puppet agent (client): <strong>[agent]</strong> (Was [puppetd] in Puppet pre 2.6)</p>

<p>For puppet apply (client): <strong>[user]</strong> (Was [puppet])</p>

<p>For puppet master (server): <strong>[master]</strong> (Was [puppetmasterd] and [puppetca])</p>

<p>Hash sign (#) can be used for comments.</p>
</div>
</div>
<div id="Using_Puppet_Configuration" class="slide " data-transition="none">
<div class="content " ref="Using_Puppet/Configuration/2">
<h1>Main configuration options</h1>

<p>To view all or a specific configuration setting:</p>

<pre><code>puppet config print all
puppet config print modulepath
</code></pre>

<p>Important options under <strong>[main]</strong> section:</p>

<pre><code>vardir = /var/lib/puppet # Path where Puppet stores dynamic data.
ssldir = $vardir/ssl # Path where SSL certifications are stored.
</code></pre>

<p>Important options Under <strong>[agent]</strong> section:</p>

<pre><code>server = puppet.example42.com # Host name of the PuppetMaster. (Default: puppet)
certname = web01.example42.com # Certificate name of the client. (Default is its fqdn)
runinterval = 60 # Number of minutes between Puppet runs, when running as service. (Default: 30)
report = true # If to send Puppet runs' reports to the **report_server**. (Default: true)
</code></pre>

<p>Important options under <strong>[master]</strong> section:</p>

<pre><code>autosign = /etc/puppet/autosign.conf # If new clients certificates are automatically signed. (Default: false)
reports = puppetdb # How to manage clients' reports (Default: store)
storeconfigs = true # If to enable store configs to support exported resources. (Default: false)
</code></pre>

<p>Full <a href="http://docs.puppetlabs.com/references/latest/configuration.html" target="_blank">configuration reference</a>  on the official site.</p>
</div>
</div>
<div id="Using_Puppet_Commands" class="slide " data-transition="none">
<div class="content " ref="Using_Puppet/Commands/1">
<h1>Using the Puppet command</h1>

<p>Puppet has different subcommands for different purproses. It's possible to add seamlessly new commands using the <strong>face</strong> interface.</p>

<pre><code>puppet help

Usage: puppet &lt;subcommand&gt; [options] &lt;action&gt; [options]

Available subcommands: (here shown the most used ones)

agent             The puppet agent daemon
apply             Apply Puppet manifests locally
ca                Local Puppet Certificate Authority management.
cert              Manage certificates and requests
config            Interact with Puppet's settings.
describe          Display help about resource types
device            Manage remote network devices
doc               Generate Puppet references
facts             Retrieve and store facts.
master            The puppet master daemon
module            Creates, installs and searches for modules on the Puppet Forge.
node              View and manage node definitions.
parser            Interact directly with the parser.
resource          The resource abstraction layer shell
</code></pre>
</div>
</div>
<div id="Using_Puppet_Commands" class="slide " data-transition="none">
<div class="content " ref="Using_Puppet/Commands/2">
<h1>Puppet operational modes</h1>

<h2>Master / Client - puppet agent</h2>

<p>It's the typical Puppet setup</p>

<ul>
<li><p>We have clients, our managed nodes, where Puppet agent is installed.</p></li>
<li><p>We have one or more Masters where Puppet server runs as a service</p></li>
<li><p>Client/Server communication is via https (<strong>port 8140</strong>)</p></li>
<li><p>Clients certificates have to be accepted (<strong>signed</strong>) on the Master</p></li>
<li><p>Command used on the client: <code>puppet agent</code>  (generally as <strong>root</strong>)</p></li>
<li><p>Command used on the server: <code>puppet master</code>  (generally as <strong>puppet</strong>)</p></li>
</ul>

<h2>Masterless - puppet apply</h2>

<p>Master less mode doesn't use a client-server infrastructure.</p>

<ul>
<li><p>Our Puppet code (written in manifests) is applied directly on the target system.</p></li>
<li><p>No need of a Puppet Master</p></li>
<li><p>We have to distribute our modules and data to the managed nodes.</p></li>
<li><p>Command used: <code>puppet apply</code> (generally as <strong>root</strong>)</p></li>
</ul>
</div>
</div>
<div id="Using_Puppet_Paths" class="slide " data-transition="none">
<div class="content " ref="Using_Puppet/Paths">
<h1>Puppet paths</h1>

<p>The paths of the most important locations are different on Puppet versions on Linux systems. Check the <a href="https://github.com/puppetlabs/puppet-specifications/blob/master/file_paths.md" target="_blank">Official specification</a> for all the details.</p>

<p>Configuration directory (<code>$confdir</code>):</p>

<pre><code>/etc/puppet/            # Puppet 3 or earlier
/etc/puppetlabs/puppet/ # Puppet 4 and PE
</code></pre>

<p>Log directory (<code>$logdir</code>):</p>

<pre><code>/var/log/puppet # Puppet 3 or earlier
/var/log/puppetlabs/puppet # Puppet 4
</code></pre>

<p>Lib directory (<code>$libdir</code>) (contains Puppet operational data such as catalog, backup of files...):</p>

<pre><code>/var/lib/puppet # Puppet 3 or earlier
/opt/puppetlabs/puppet/lib # Puppet 4
</code></pre>

<p>SSL directory (<code>$libdir</code>) (contains all the SSL certificates)</p>

<pre><code>$libdir/ssl  # Puppet 3 or earlier
$confdir/ssl # Puppet 4
</code></pre>

<p>Manifest file (the first manifest parsed by the Master when compiling the catalog</p>

<pre><code>/etc/puppet/manifests/site.pp # Puppet 3 with config-file environments
/etc/puppet/environments/$environment/manifests/site.pp # Puppet 3 with directory environments
/etc/puppetlabs/code/environments/$environment/manifests/site.pp # Puppet 4
</code></pre>

<p>Modulepath (comma separated directories where modules are stored):</p>

<pre><code>/etc/puppet/modules:/usr/share/puppet/modules # Puppet 3
/etc/puppet/environments/$environment/modules # Added modules dir in Puppet 3 when using **directory environments**
/etc/puppetlabs/code/environments/$environment/modules # Puppet 4
</code></pre>

<p>Code directory in Puppet 4:</p>

<pre><code>/etc/puppetlabs/code # $codedir
/etc/puppetlabs/code/environments/$environment # $environmentpath
</code></pre>

<p>Inside the $environmentpath</p>

<pre><code>hieradata/ # Hiera files dir
modules/   # User modulepath    
manifests/ # Manifests dirs
environment.conf
</code></pre>
</div>
</div>
<div id="Using_Puppet_Troubleshooting" class="slide " data-transition="none">
<div class="content " ref="Using_Puppet/Troubleshooting">
<h1>Anatomy of a Puppet Run</h1>

<p>Execute Puppet on the client</p>

<pre><code>Client shell # puppet agent -t
</code></pre>

<p>If pluginsync = true (default from Puppet 3.0) the client retrieves all extra plugins (facts, types and providers) present in modules on the server's $modulepath</p>

<pre><code>Client output # Info: Retrieving plugin
</code></pre>

<p>The client runs facter and send its facts to the server</p>

<pre><code>Client output # Info: Loading facts in /var/lib/puppet/lib/facter/... [...]
</code></pre>

<p>The server looks for the client's hostname (or certname, if different from the hostname) and looks into its nodes list</p>

<p>The server compiles the catalog for the client using also client's facts.</p>

<pre><code>Server's logs # Compiled catalog for &lt;client&gt; in environment production in 8.22 seconds
</code></pre>

<p>If there are not syntax errors in the processed Puppet code, the server sends the catalog to the client, in PSON format.</p>

<pre><code>Client output # Info: Caching catalog for &lt;client&gt;
</code></pre>

<p>The client receives the catalog and starts to apply it locally
If there are dependency loops the catalog can't be applied and the whole tun fails.</p>

<pre><code>Client output # Info: Applying configuration version '1355353107'
</code></pre>

<p>All changes to the system are shown here. If there are errors (in red or pink, according to Puppet versions) they are relevant to specific resources but do not block the application of the other resources (unless they depend on the failed ones).</p>

<p>At the end ot the Puppet run the client sends to the server a report of what has been changed</p>

<pre><code>Client output # Finished catalog run in 13.78 seconds
</code></pre>

<p>The server eventually sends the report to a Report Collector.</p>
</div>
</div>
<div id="Appendix_Overview" class="slide " data-transition="none">
<div class="content " ref="Appendix/Overview">
<h1>Appendix</h1>

<h2>Contents</h2>

<ul>
<li>History of Puppet versions</li>
<li>Migrating to Puppet 4</li>
<li>Introduction to Hiera</li>
</ul>

<h2>Take-aways</h2>

<ul>
<li>Have an idea of Puppet versions history and evolution</li>
<li>Understand the main challenges involved in migration to Puppet 4</li>
<li>Have online references on Puppet 4 migration</li>
<li>Have a general Hiera of what Hiera is and how is used</li>
<li>Have a general idea of how to configure Hiera </li>
</ul>
</div>
</div>
<div id="Appendix_History" class="slide " data-transition="none">
<div class="content " ref="Appendix/History">
<h1>History of Puppet Versions</h1>

<p>During its history Puppet has constantly improved and added features, still most of the core principles are the same and have't changed.</p>

<p>From version 2 Puppet follows <a href="http://semver.org/" target="_blank">Semantic Versioning</a> standards to manage versioning, with a pattern like: MAJOR.MINOR.PATCH</p>

<p>This implies that MAYOR versions might not be backwards compatible, MINOR versions may introduce new features keeping compatibility and PATCHes are for backwards compatible bug fixes.</p>

<p>This is the history of the main Puppet versions and some relevant changes
Check also <a href="http://docs.puppetlabs.com/guides/language_history.html" target="_blank">Puppet Language History</a> for a more complete review:</p>

<ul>
<li>
<code>0.9.x</code>  - First public beta</li>
<li>
<code>0.10.x</code> - 0.21.x - Various "early" versions</li>
<li>
<code>0.22.x</code> - 0.25.x - Improvements and OS wider support</li>
<li>
<code>2.6.x</code>  - Many changes. Parametrized classes</li>
<li>
<code>2.7.x</code>  - Windows support</li>
<li>
<code>3.0.x</code>  - Many changes. Disabled dynamic variables scope. Data bindings</li>
<li>
<code>3.2.x</code>  - Future parser (experimental, will be default in Puppet 4)</li>
<li>
<code>4.x.x</code>  - Released in early 2015. New parser, new type system and lot of changes, various language cleanups and some backwards incompatibilities</li>
</ul>
</div>
</div>
<div id="Appendix_Puppet4_migration" class="slide " data-transition="none">
<div class="content " ref="Appendix/Puppet4_migration">
<h1>Migrating to Puppet 4</h1>

<p>With Puppet 4 many things have changed:</p>

<ul>
<li>New Parser, new Type system, a lot of code tuning</li>
<li>Puppet agent and its components (facter, mcollective and the relevant stack) is shipped with All In One package (AIO) to retrieve from PuppetLabs site</li>
<li>All directory paths are changed</li>
<li>The Master function is done via <strong>Puppet Server</strong> (a new dedicated clojure application)</li>
</ul>

<p>Migration from previous versions to Puppet 4 probably need some code refactoring.</p>

<p>Good online resources to prepare the migration to Puppet 4 are:</p>

<ul>
<li>Online reference for <a href="https://docs.puppetlabs.com/puppet/latest/reference/experiments_future.html" target="_blank">upgrading manifests</a> from 3.x to 4.x</li>
<li>Article on how to <a href="http://www.camptocamp.com/en/actualite/getting-code-ready-puppet-4/" target="_blank">prepare our code</a> for Puppet 4.</li>
</ul>

<p>Use the <a href="https://forge.puppetlabs.com/modules?" target="_blank">Puppet Forge search</a> page to look for Puppet 4 compatible modules (note that most of them may not exploit fullt Puppet 4 power due to backwards 3.x compatibility).</p>

<p>Some other useful links about Puppet 4:</p>

<ul>
<li>Puppet 4 <a href="https://docs.puppetlabs.com/puppet/4.0/reference/release_notes.html" target="_blank">release notes</a>
</li>
<li>Online reference for <a href="https://docs.puppetlabs.com/puppet/4.0/reference/upgrade_agent.html" target="_blank">agent</a> upgrade</li>
<li>Online reference for <a href="https://docs.puppetlabs.com/puppet/4.0/reference/upgrade_server.html" target="_blank">server</a> upgrade</li>
</ul>
</div>
</div>
<div id="Appendix_Hiera_Introduction" class="slide " data-transition="none">
<div class="content " ref="Appendix/Hiera_Introduction/1">
<h1>Introduction to Hiera</h1>

<p>Hiera is the most used solution to manage the data we need to configure our systems according to the logic we need.</p>

<p>It allows to separate data from code, allowing us to avoid to place inside our Puppet manifests information which is strictly related to our infrastructure and its settings.</p>

<p>It's shipped together with Puppet from version 3 and it's strictly integrated: for each class parameter Puppet does an automatic lookup on a corresponding Hiera value.</p>

<p>Hiera can use different backends to store it's data. The default one is Yaml (all data is placed in simple Yaml files). Other backend are Json, Mysql, Redis and so on.</p>

<p>Data is looked on Hiera following a hierarchy based on Puppet variables, in this way we can attribute to an Hiera Key (for example <code>ntp::server</code>) different values according to different conditions (for example the role, the environment or the location of a server).</p>

<p>Inside Puppet code with can use the <code>hiera()</code> function to look for a given Hiera key. For example the following code assign to the variable <code>$server</code> the value of the Hiera key called <code>ntp_server</code>. An optional parameter can be added to set the default value (here <code>ntp.pool.org</code>) to return if the key is not found on Hiera:</p>

<pre><code>$server = hiera('ntp_server','ntp.pool.org')
</code></pre>

<p>Since Puppet 3 Puppet does an automatic lookup on Hiera for each parameter of a class. In the following example the parameter <code>server</code> (whose value can be referred, inside the same class, using the <code>$server</code> variable and, inside any other class with its <em>fully qualified name</em>: <code>$::ntp::server</code>) can be changed by setting, on Hiera a value for the key called <code>ntp::server</code>:</p>

<pre><code>class ntp (
  server = 'ntp.pool.org',
) { }
</code></pre>
</div>
</div>
<div id="Appendix_Hiera_Introduction" class="slide " data-transition="none">
<div class="content " ref="Appendix/Hiera_Introduction/2">
<h1>Hiera configuration</h1>

<p>Hiera's configuration file for Puppet is <code>/etc/puppet/hiera.yaml</code> (On Puppet 4 <code>/etc/puppet/puppetlabs/hiera.yaml</code>). It's a Yaml file which looks like this:</p>

<pre><code>---
  :backends:
    - yaml

  :hierarchy:
     - "%{::environment}/nodes/%{::fqdn}"
     - "%{::environment}/roles/%{::role}"
     - "%{::environment}/zones/%{::zone}"
     - "%{::environment}/common"
   :yaml:
     :datadir: /etc/puppet/hieradata
</code></pre>

<p>In the above sample it's configured the <strong>backend(s)</strong> to use, the <strong>hierarchy</strong> based on Puppet variables (inside <code>%{}</code>) and the configuration specific to the used backend (here is set the <strong>datadir</strong> when Yaml files containing Hiera keys are placed, named acconding to the defined hierarchy).</p>
</div>
</div>
</div>
<div id="pauseScreen">
  PAUSED
</div>

</body>
</html>
