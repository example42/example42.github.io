<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=1024, user-scalable=no">

	<title>How to use Example42 NextGen Modules</title>
	
	<!-- Required stylesheet -->
	<link rel="stylesheet" href="core/deck.core.css">
	
	<!-- Extension CSS files go here. Remove or add as needed. -->	
	<link rel="stylesheet" href="extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="extensions/navigation/deck.navigation.css">
	<link rel="stylesheet" href="extensions/status/deck.status.css">
	<link rel="stylesheet" href="extensions/hash/deck.hash.css">
	<link rel="stylesheet" href="extensions/scale/deck.scale.css">
	<link rel="stylesheet" href="extensions/title/deck.title.css">	
	<link rel="stylesheet" href="extensions/highlight/deck.highlight.css">	

	

	<!-- Style theme. More available in /themes/style/ or create your own. -->
	<link rel="stylesheet" href="themes/style/swiss.css">
	
	<!-- Transition theme. More available in /themes/transition/ or create your own. -->
	<link rel="stylesheet" href="themes/transition/horizontal-slide.css">
	
	<!-- Required Modernizr file -->
	<script src="modernizr.custom.js"></script>
	
</head>
<body class="deck-container">

<!-- Begin slides. Just make elements with a class of slide. -->


  <!-- First slide -->  
  <section class="slide">
     <header>How to use Example42 NextGen Modules</header>
        
     <address class="author">By Alessandro Franceschi</address>
     
     
     <address class="company">Lab42</address>
          
     <address><time>16-06-2014</time></address>
  </section>
  


  <section class="slide">
     
     
           
       
         <h2>Ten Design Choices for Example42 Puppet Modules</h2>
       
                            
     <p>1 - Provide alternatives for Data Separation</p>
<p>2 - Provide choice on Configuration Files supply</p>
<p>3 - Configure everything but provide OS defaults.</p>
<p>4 - Allow management of general module's behavior</p>
<p>5 - Allow Custom Options for endless parameters</p>
<p>6 - Permit easy extension with custom classes</p>
<p>7 - Offer easy removal of the module's resources</p>
<p>8 - Limit cross-dependencies. Prerequisites as options.</p>
<p>9 - Automatically monitor and firewall resources</p>
<p>10 - Puppi integration: <abbr title="Puppet automation tool">Puppet</abbr> knowledge to the CLI</p>
  </section>

  <section class="slide">
     
     
           
       
         <h2>DATA SEPARATION ALTERNATIVES</h2>
       
                            
     <ul> 
 <li class=" slide"><p>Set (Top Scope/External Node Classifier) variables and include classes:</p> <pre class=" code"><code><span class="java_plain">$</span><span class="java_operator">::</span><span class="java_plain">openssh_template&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">'site/openssh/openssh.conf.erb'</span><span class="java_plain"></span>
<span class="java_plain">include&nbsp;openssh</span></code></pre></li> 
 <li class=" slide"><p>Use Hiera:</p> <pre class=" code"><code><span class="java_plain">hiera</span><span class="java_separator">(</span><span class="java_literal">'openssh_template'</span><span class="java_separator">)</span><span class="java_plain"></span>
<span class="java_plain">include&nbsp;openssh</span></code></pre></li> 
 <li class=" slide"><p>Use Parametrized Classes:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;template&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'site/openssh/openssh.conf.erb'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>Happily mix different patterns:</p> <pre class=" code"><code><span class="java_plain">$</span><span class="java_operator">::</span><span class="java_plain">monitor&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain"></span>
<span class="java_plain">$</span><span class="java_operator">::</span><span class="java_plain">monitor_tool&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">[</span><span class="java_plain">&nbsp;</span><span class="java_literal">'nagios'</span><span class="java_plain">&nbsp;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">'munin'</span><span class="java_plain">&nbsp;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">'puppi'</span><span class="java_plain">&nbsp;</span><span class="java_separator">]</span><span class="java_plain"></span>
<span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;template&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'site/openssh/openssh.conf.erb'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>PARAMS_LOOKUP EVERYWHERE</h2>
       
                            
     <ul> 
 <li class=" slide"><p>Each parameter is processed by the params_lookup function</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;openssh&nbsp;</span><span class="java_separator">(</span><span class="java_plain"></span>
<span class="java_separator">[...]</span><span class="java_plain">&nbsp;#&nbsp;openssh&nbsp;module&nbsp;specific&nbsp;parameters&nbsp;</span><span class="java_separator">...</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$my_class&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;params_lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">'my_class'</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$source&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;params_lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">'source'</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$source_dir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;params_lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">'source_dir'</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$source_dir_purge&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;params_lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">'source_dir_purge'</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$template&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;params_lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">'template'</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$service_autorestart&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;params_lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">'service_autorestart'</span><span class="java_plain">&nbsp;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">'global'</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$options&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;params_lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">'options'</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;params_lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">'version'</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$absent&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;params_lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">'absent'</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$disable&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;params_lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">'disable'</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$disableboot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;params_lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">'disableboot'</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$monitor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;params_lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">'monitor'</span><span class="java_plain">&nbsp;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">'global'</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$monitor_tool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;params_lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">'monitor_tool'</span><span class="java_plain">&nbsp;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">'global'</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$monitor_target&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;params_lookup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">'monitor_target'</span><span class="java_plain">&nbsp;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">'global'</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_separator">[...]</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;inherits&nbsp;openssh</span><span class="java_operator">::</span><span class="java_plain">params&nbsp;</span><span class="java_separator">{</span><span class="java_plain"></span>
<span class="java_separator">[...]</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>Flexibility on booleans: they are sanitized by the any2bool function<br />You set:</p> <pre class=" code"><code><span class="java_plain">$absent&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;yes&quot;</span><span class="java_plain">&nbsp;#&nbsp;</span><span class="java_separator">(</span><span class="java_plain">or&nbsp;</span><span class="java_literal">&quot;1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">'Y'</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;true&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain">&nbsp;</span><span class="java_separator">...)</span><span class="java_plain"></span></code></pre><p>The module internally uses:</p> <pre class=" code"><code><span class="java_plain">$bool_absent&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;any2bool</span><span class="java_separator">(</span><span class="java_plain">$absent</span><span class="java_separator">)</span><span class="java_plain"></span></code></pre></li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>PARAMS LOOKUP ORDER</h2>
       
                            
     <ul> 
 <li class=" slide"><p>The function params_lookup is provided by the Puppi module</p></li> 
 <li class=" slide"><p>It allows data to be defined in different ways:</p> 
  <ul> 
   <li class=" slide">Via Hiera, if available</li> 
   <li class=" slide">As Top Scope variable (as provided by External Node Classifiers)</li> 
   <li class=" slide">Via defaults set in the module's params class</li> 
  </ul></li> 
 <li class=" slide"><p>The &quot;global&quot; argument is used to define site_wide behavior<br />If there's a direct param that's the value </p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span>
<span class="java_plain">&nbsp;&nbsp;monitor&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>Otherwise, If Hiera is available: </p> <pre class=" code"><code><span class="java_plain">hiera</span><span class="java_separator">(</span><span class="java_literal">&quot;monitor&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;</span><span class="java_type">If</span><span class="java_plain">&nbsp;global&nbsp;lookup&nbsp;is&nbsp;set</span>
<span class="java_plain">hiera</span><span class="java_separator">(</span><span class="java_literal">&quot;openssh_monitor&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;#&nbsp;A&nbsp;specific&nbsp;value&nbsp;overrides&nbsp;the&nbsp;global&nbsp;one</span></code></pre></li> 
 <li class=" slide"><p>If variable is still not evaluated, Top Scope is looked up:</p> <pre class=" code"><code><span class="java_plain">$</span><span class="java_operator">::</span><span class="java_plain">monitor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;</span><span class="java_type">If</span><span class="java_plain">&nbsp;global&nbsp;lookup&nbsp;is&nbsp;set</span>
<span class="java_plain">$</span><span class="java_operator">::</span><span class="java_plain">openssh_monitor&nbsp;#&nbsp;</span><span class="java_type">If</span><span class="java_plain">&nbsp;present</span><span class="java_separator">,</span><span class="java_plain">&nbsp;overrides&nbsp;$</span><span class="java_operator">::</span><span class="java_plain">monitor</span></code></pre></li> 
 <li class=" slide"><p>Module's params are used as last option defaults:</p> <pre class=" code"><code><span class="java_plain">$openssh</span><span class="java_operator">::</span><span class="java_plain">params</span><span class="java_operator">::</span><span class="java_plain">monitor</span></code></pre></li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>CUSTOMIZE: CONFIGURATION FILE</h2>
       
                            
     <ul> 
 <li class=" slide"><p>Provide Main Configuration as a static file ...</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;source&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'puppet:///modules/site/ssh/sshd.conf'</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>... an array of files looked up on a first match logic ...</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;source&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">[</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;puppet:///modules/site/ssh/sshd.conf-${fqdn}&quot;</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;puppet:///modules/site/ssh/openssh.conf&quot;</span><span class="java_separator">],</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>... or an erb template:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;template&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'site/ssh/sshd.conf.erb'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>Config File Path is defined in params.pp (can be overriden):</p> <pre class=" code"><code><span class="java_plain">config_file&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'/etc/ssh/sshd_config'</span><span class="java_separator">,</span><span class="java_plain"></span></code></pre></li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>CUSTOMIZE: CONFIGURATION DIR</h2>
       
                            
     <ul> 
 <li class=" slide"><p>You can manage the whole Configuration Directory:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;source_dir&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'puppet:///modules/site/ssh/sshd/'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>This copies all the files in lab42/files/ssh/sshd/* to local config_dir</p></li> 
 <li class=" slide"><p>You can purge any existing file on the destination config_dir which are not present on the source_dir path:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;source_dir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'puppet:///modules/site/ssh/sshd/'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;source_dir_purge&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">,</span><span class="java_plain">&nbsp;#&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;is&nbsp;</span><span class="java_literal">false</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre><p>WARNING: Use with care</p></li> 
 <li class=" slide"><p>Config Dir Path is defined in params.pp (can be overriden):</p> <pre class=" code"><code><span class="java_plain">config_dir&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'/etc/ssh'</span><span class="java_separator">,</span><span class="java_plain"></span></code></pre></li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>CUSTOMIZE: PATHS AND NAMES</h2>
       
                            
     <ul> 
 <li class=" slide"><p>Customize Application Parameters. An example:<br />Use the puppet module to manage pe-puppet!</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'puppet'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;template&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'lab42/pe-puppet/puppet.conf.erb'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">package</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'pe-puppet'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;service&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'pe-puppet'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;service_status&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;config_file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'/etc/puppetlabs/puppet/puppet.conf'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;config_file_owner&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'root'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;config_file_group&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'root'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;config_file_init&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'/etc/sysconfig/pe-puppet'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;process&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'ruby'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;process_args&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'puppet'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;process_user&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'root'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;config_dir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'/etc/puppetlabs/puppet/'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;pid_file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'/var/run/pe-puppet/agent.pid'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;log_file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'/var/log/pe-puppet/puppet.log'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;log_dir&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'/var/log/pe-puppet'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>DEFAULTS IN PARAMS.PP</h2>
       
                            
     <ul> 
 <li class=" slide"><p>Each module has a params class with defaults for different OS</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;openssh</span><span class="java_operator">::</span><span class="java_plain">params&nbsp;</span><span class="java_separator">{</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;###&nbsp;</span><span class="java_type">Application</span><span class="java_plain">&nbsp;related&nbsp;parameters</span>
<span class="java_plain">&nbsp;&nbsp;$package&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;$</span><span class="java_operator">::</span><span class="java_plain">operatingsystem&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh-server'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$service&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;$</span><span class="java_operator">::</span><span class="java_plain">operatingsystem&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">/</span><span class="java_separator">(</span><span class="java_operator">?</span><span class="java_plain">i</span><span class="java_operator">:</span><span class="java_type">Debian</span><span class="java_operator">|</span><span class="java_type">Ubuntu</span><span class="java_operator">|</span><span class="java_type">Mint</span><span class="java_separator">)</span><span class="java_operator">/</span><span class="java_plain">&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'ssh'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'sshd'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$process&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;$</span><span class="java_operator">::</span><span class="java_plain">operatingsystem&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">default</span><span class="java_plain">&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'sshd'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">[...]</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$port&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">'22'</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$protocol&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">'tcp'</span><span class="java_plain"></span>
<span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;#&nbsp;</span><span class="java_type">General</span><span class="java_plain">&nbsp;</span><span class="java_type">Settings</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$my_class&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">''</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$source&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">''</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$source_dir&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">''</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$source_dir_purge&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">''</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">[...]</span><span class="java_plain"></span>
<span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;###&nbsp;</span><span class="java_type">General</span><span class="java_plain">&nbsp;module&nbsp;variables&nbsp;that&nbsp;can&nbsp;have&nbsp;a&nbsp;site&nbsp;or&nbsp;per&nbsp;module&nbsp;</span><span class="java_keyword">default</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$monitor&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$monitor_tool&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">''</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$monitor_target&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;$</span><span class="java_operator">::</span><span class="java_plain">ipaddress</span>
<span class="java_plain">&nbsp;&nbsp;$firewall&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$firewall_tool&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">''</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;$firewall_src&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">'0.0.0.0/0'</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">[...]</span><span class="java_plain"></span></code></pre></li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>MANAGE BEHAVIOR</h2>
       
                            
     <ul> 
 <li class=" slide"><p>Enable Auditing:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;audit_only&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">,</span><span class="java_plain">&nbsp;#&nbsp;</span><span class="java_type">Default</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre><p>No changes to configuration files are actually made and potential changes are audited</p></li> 
 <li class=" slide"><p>Manage Service Autorestart:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;service_autorestart&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">,</span><span class="java_plain">&nbsp;#&nbsp;</span><span class="java_type">Default</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre><p>No automatic service restart when a configuration file / dir changes</p></li> 
 <li class=" slide"><p>Manage Software Version:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'foo'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;version&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'1.2.0'</span><span class="java_separator">,</span><span class="java_plain">&nbsp;#&nbsp;</span><span class="java_type">Default</span><span class="java_operator">:</span><span class="java_plain">&nbsp;unset</span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre><p>Specify the package version you want to be installed.<br />Set =&gt; 'latest' to force installation of latest version </p></li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>CUSTOM OPTIONS</h2>
       
                            
     <ul> 
 <li class=" slide"><p>With templates you can provide an hash of custom options:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;template&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'site/ssh/sshd.conf.erb'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;options&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">'LogLevel'</span><span class="java_plain">&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'INFO'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">'UsePAM'</span><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'yes'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">},</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>The Hash values can be used in your custom templates with the <strong>options_lookup</strong> function<br />(Use the option value or set a default)</p> <pre class=" code"><code><span class="java_type">UsePAM</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;%=</span><span class="java_plain">&nbsp;scope</span><span class="java_separator">.</span><span class="java_plain">function_options_lookup</span><span class="java_separator">([</span><span class="java_literal">'UsePAM'</span><span class="java_separator">,</span><span class="java_literal">'no'</span><span class="java_separator">])</span><span class="java_plain">&nbsp;</span><span class="java_operator">%&gt;</span><span class="java_plain"></span>
<span class="java_type">LogLevel</span><span class="java_plain">&nbsp;</span><span class="java_operator">&lt;%=</span><span class="java_plain">&nbsp;scope</span><span class="java_separator">.</span><span class="java_plain">function_options_lookup</span><span class="java_separator">([</span><span class="java_literal">'LogLevel'</span><span class="java_separator">,</span><span class="java_literal">'INFO'</span><span class="java_separator">])</span><span class="java_plain">&nbsp;</span><span class="java_operator">%&gt;</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>This allows management of any kind of configuration parameter:</p><p>Provide endless configuration values without adding new parameters</p></li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>CUSTOMIZE: CUSTOM CLASS</h2>
       
                            
     <ul> 
 <li class=" slide"><p>Provide added resources in a Custom Class:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;my_class&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'site/my_openssh'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre><p>This autoloads: site/manifests/my_openssh.pp </p></li> 
 <li class=" slide"><p>Custom class can stay in your site module:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;site</span><span class="java_operator">::</span><span class="java_plain">my_openssh&nbsp;</span><span class="java_separator">{</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;file&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'motd'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'/etc/motd'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;content&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;template</span><span class="java_separator">(</span><span class="java_literal">'site/openssh/motd.erb'</span><span class="java_separator">),</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre><p>You hardly need to inherit openssh: there are parameters for everything<br />Do not call your class site::openssh, naming collisions could happen. </p></li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>EASY DECOMMISSIONING</h2>
       
                            
     <ul> 
 <li class=" slide"><p>Disable openssh service:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;disable&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>Deactivate openssh service only at boot time:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;disableboot&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre><p>Useful when a service is managed by another tool (ie: a cluster suite)</p></li> 
 <li class=" slide"><p>Remove openssh (package and files):</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;absent&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>Monitoring and firewalling resources removal is automatically managed</p></li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>CROSS-MODULE INTEGRATIONS</h2>
       
                            
     <ul> 
 <li class=" slide"><p>Integration with other modules sets and conflicts management is not easy.</p></li> 
 <li class=" slide"><p>Provide the option to use the module's prerequisite resources:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'logstash'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;install_prerequisites&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_separator">,</span><span class="java_plain">&nbsp;#&nbsp;</span><span class="java_type">Default</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre><p>The prerequisites resources for this module are installed automatically BUT can be managed by third-party modules</p></li> 
 <li class=" slide"><p>Play well with others: Use if ! defined when defining common resources</p> <pre class=" code"><code><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_operator">!</span><span class="java_plain">&nbsp;defined</span><span class="java_separator">(</span><span class="java_type">Package</span><span class="java_separator">[</span><span class="java_literal">'git'</span><span class="java_separator">])</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">package</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'git'</span><span class="java_operator">:</span><span class="java_plain">&nbsp;ensure&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;installed&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre><p>Not a definitive solution, but better than nothing.</p></li> 
 <li class=" slide"><p>Always define in Modulefile the module's dependencies</p> <pre class=" code"><code><span class="java_plain">dependency&nbsp;</span><span class="java_literal">'example42/puppi'</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">'&gt;=&nbsp;2.0.0'</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>Never assume your resource defaults are set for others</p> <pre class=" code"><code><span class="java_type">Exec</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;path&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;/bin:/sbin:/usr/bin:/usr/sbin&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>EXTEND: MONITOR</h2>
       
                            
     <ul> 
 <li class=" slide"><p>Manage Abstract Automatic Monitoring:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;monitor&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;monitor_tool&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">[</span><span class="java_plain">&nbsp;</span><span class="java_literal">'nagios'</span><span class="java_separator">,</span><span class="java_literal">'puppi'</span><span class="java_separator">,</span><span class="java_literal">'monit'</span><span class="java_plain">&nbsp;</span><span class="java_separator">],</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;monitor_target&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;$</span><span class="java_operator">::</span><span class="java_plain">ip_address&nbsp;#&nbsp;</span><span class="java_type">Default</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre><p>Monitoring is based on these parameters defined in params.pp:</p> <pre class=" code"><code><span class="java_plain">port&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'22'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;protocol&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'tcp'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;service&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'ssh[d]'</span><span class="java_separator">,</span><span class="java_plain">&nbsp;&nbsp;#&nbsp;</span><span class="java_type">According</span><span class="java_plain">&nbsp;to&nbsp;OS&nbsp;</span>
<span class="java_plain">&nbsp;&nbsp;process&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'sshd'</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<span class="java_plain">&nbsp;&nbsp;process_args&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">''</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;process_user&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'root'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;pid_file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'/var/run/sshd.pid'</span><span class="java_separator">,</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>Abstraction is managed in the Example42 monitor module<br />Here &quot;connectors&quot; for different monitoring tools are defined and can be added (also using 3rd party modules).</p></li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>EXTEND: FIREWALL</h2>
       
                            
     <ul> 
 <li class=" slide"><p>Manage Automatic Firewalling (host based):</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;firewall&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;firewall_tool&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'iptables'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;firewall_src&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'10.0.0.0/8'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;firewall_dst&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;$</span><span class="java_operator">::</span><span class="java_plain">ipaddress_eth1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;#&nbsp;</span><span class="java_type">Default</span><span class="java_plain">&nbsp;is&nbsp;$</span><span class="java_operator">::</span><span class="java_plain">ipaddress</span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>Firewalling is based on these parameters defined in params.pp:</p> <pre class=" code"><code><span class="java_plain">port&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'22'</span><span class="java_separator">,</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;protocol&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'tcp'</span><span class="java_separator">,</span><span class="java_plain"></span></code></pre></li> 
</ul> 
<ul> 
 <li class=" slide">Abstraction is managed in the Example42 firewall module<br />Currently only the &quot;iptables&quot; firewall_tool is defined, it uses Example42 iptables module to manage local iptables rules</li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>EXTEND PUPPI</h2>
       
                            
     <ul> 
 <li class=" slide"><p>Manage Puppi Integration:</p> <pre class=" code"><code><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_literal">'openssh'</span><span class="java_operator">:</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;puppi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">true</span><span class="java_separator">,</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;</span><span class="java_type">Default</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_literal">false</span><span class="java_plain"></span>
<span class="java_plain">&nbsp;&nbsp;puppi_helper&nbsp;</span><span class="java_operator">=&gt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">'standard'</span><span class="java_separator">,</span><span class="java_plain">&nbsp;#&nbsp;</span><span class="java_type">Default</span><span class="java_plain"></span>
<span class="java_separator">}</span><span class="java_plain"></span></code></pre></li> 
 <li class=" slide"><p>The Puppi module is a prerequisite for all Example42 modules<br /> Is required because it provides common libs, widely used in the modules<br /> BUT the actual puppi integration is optional (and disabled by default)</p></li> 
 <li class=" slide"><p>Puppi integration allows CLI enrichment commands like:</p> <pre class=" code"><code><span class="java_plain">puppi&nbsp;info&nbsp;openssh</span>
<span class="java_plain">puppi&nbsp;log&nbsp;openssh</span>
<span class="java_plain">puppi&nbsp;check&nbsp;openssh</span></code></pre><p>Note: puppi support for info/log commands for NextGen modules is under development</p></li> 
 <li class=" slide"><p>Puppi helpers allow you to customize Puppi behavior </p></li> 
</ul>
  </section>

  <section class="slide">
     
     
           
       
         <h2>How to make a NextGen module</h2>
       
                            
     <ul> 
 <li class=" slide"><p>Get from GitHub the Next-Gen modules set:</p> <pre class=" code"><code><span class="java_plain">git&nbsp;clone&nbsp;</span><span class="java_operator">--</span><span class="java_plain">recursive&nbsp;http</span><span class="java_operator">:</span><span class="java_comment">//github.com/example42/puppet-modules-nextgen</span>
<span class="java_plain">cd&nbsp;puppet</span><span class="java_operator">-</span><span class="java_plain">modules</span><span class="java_operator">-</span><span class="java_plain">nextgen</span></code></pre></li> 
 <li class=" slide"><p>Create a module (name will be prompted) based on the template in Example42-templates/standard42:</p> <pre class=" code"><code><span class="java_type">Example42</span><span class="java_operator">-</span><span class="java_plain">tools</span><span class="java_operator">/</span><span class="java_plain">module_clone</span><span class="java_separator">.</span><span class="java_plain">sh&nbsp;</span><span class="java_operator">-</span><span class="java_plain">t&nbsp;standard42</span></code></pre></li> 
 <li class=" slide"><p>Create a module cloned from the existing module mysql:</p> <pre class=" code"><code><span class="java_type">Example42</span><span class="java_operator">-</span><span class="java_plain">tools</span><span class="java_operator">/</span><span class="java_plain">module_clone</span><span class="java_separator">.</span><span class="java_plain">sh&nbsp;</span><span class="java_operator">-</span><span class="java_plain">m&nbsp;mysql</span></code></pre></li> 
 <li class=" slide"><p>Create a module called vim based on Example42-templates/minimal42:</p> <pre class=" code"><code><span class="java_type">Example42</span><span class="java_operator">-</span><span class="java_plain">tools</span><span class="java_operator">/</span><span class="java_plain">module_clone</span><span class="java_separator">.</span><span class="java_plain">sh&nbsp;</span><span class="java_operator">-</span><span class="java_plain">t&nbsp;minimal42&nbsp;</span><span class="java_operator">-</span><span class="java_plain">n&nbsp;vim</span></code></pre></li> 
</ul>
  </section>


<!-- End slides. -->


<!-- Begin extension snippets. Add or remove as needed. -->

<!-- deck.navigation snippet -->
<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<!-- deck.logo snippet -->


<!-- deck.status snippet -->
<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<!-- deck.goto snippet -->
<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
	<datalist id="goto-datalist"></datalist>
	<input type="submit" value="Go">
</form>

<!-- deck.hash snippet -->
<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<!-- End extension snippets. -->


<!-- Required JS files. -->
<script src="jquery-1.12.4.min.js"></script>
<script src="core/deck.core.js"></script>

<!-- Extension JS files. Add or remove as needed. -->
<script src="extensions/hash/deck.hash.js"></script>
<script src="extensions/menu/deck.menu.js"></script>
<script src="extensions/goto/deck.goto.js"></script>
<script src="extensions/status/deck.status.js"></script>
<script src="extensions/navigation/deck.navigation.js"></script>
<script src="extensions/scale/deck.scale.js"></script>

<!-- Initialize the deck. You can put this in an external file if desired. -->
<script>
	$(function() {
		$.deck('.slide');
	});
	
</script>
</body>
</html>
